<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Rest API V2 by clicksign</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">Rest API V2</h1>
        <p class="header">Rest API V2</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/clicksign/rest-api-v2/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/clicksign/rest-api-v2/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/clicksign/rest-api-v2">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/clicksign">clicksign</a></p>


      </header>
      <section>
        <h1>
<a name="%C3%8Dndice" class="anchor" href="#%C3%8Dndice"><span class="octicon octicon-link"></span></a>Índice</h1>

<ul>
<li><a href="#introducao">Introdução</a></li>
<li><a href="#funcionamento-geral">Funcionamento geral</a></li>
<li><a href="#autenticacao">Autenticação</a></li>
<li><a href="#versao">Versão</a></li>
<li><a href="#upload-de-documentos">Upload de documentos</a></li>
<li><a href="#criacao-de-lista-de-assinatura">Criação de lista de assinatura</a></li>
<li><a href="#hooks">Hooks</a></li>
<li><a href="#exemplos">Exemplos</a></li>
</ul><h1>
<a name="introdu%C3%A7%C3%A3o" class="anchor" href="#introdu%C3%A7%C3%A3o"><span class="octicon octicon-link"></span></a>
<a name="introducao"></a>Introdução</h1>

<p>A Clicksign é uma solução online para enviar, guardar e assinar documentos, com validade jurídica. Foi criada para facilitar, reduzir custo e aumentar a segurança e compliance do processo de assinatura e <em>workflow</em> de documentos. </p>

<p>A Clicksign pode ser acessada em <a href="https://desk.clicksign.com">https://desk.clicksign.com</a>. </p>

<p>O propósito desta <strong>REST API</strong> é prover meios para que nossos clientes adequem a Clicksign aos seus processos e sistemas p. ex. automatizar tarefas, desenhar fluxos de assinatura, e definir <em>workflow</em>. </p>

<p>Qualquer linguagem de programação compativel com requisições <strong>HTTP / JSON</strong> cumpre os requisitos necessários para consumir os serviços desta API. Assim, com pouco esforço de programação é possível integrar desde scripts shell até sistemas de ERP.</p>

<h1>
<a name="funcionamento-geral" class="anchor" href="#funcionamento-geral"><span class="octicon octicon-link"></span></a>
<a name="funcionamento-geral"></a>Funcionamento geral</h1>

<p>Uma <em>REST API</em> é composta, basicamente, por dois elementos: um <strong>cliente</strong> e um <strong>servidor</strong>. O cliente sempre inicia a comunicação mediante requisição HTTP. O servidor sempre finaliza a comunicação respondendo à requisição.</p>

<p align="center">
  <img src="https://raw.github.com/clicksign/rest-api-v2/master/images/client-server.png"></p>

<p>As mensagens HTTP são compostas por uma linha inicial, um conjunto de cabeçalhos e um corpo. A linha inicial difere nas requisições e nas respostas, o cabeçalho compartilha parâmetros em comum e parâmetros específicos, e o corpo é completamente dependente de cada mensagem, podendo até ser nulo.</p>

<p>A requisição, em sua linha inicial, indica o <strong>método</strong>, o <strong>caminho</strong>, e a <strong>versão do protocolo</strong>. O método e o caminho são essenciais em uma <em>REST API</em> uma vez que ambos indicam a ação a ser executada no servidor.</p>

<p>A resposta, em sua linha inicial, indica a <strong>versão do protocolo</strong>, o <strong>status</strong>, e contém uma <strong>mensagem informativa</strong>. O código de status é essencial para o cliente saber se a ação foi devidamente executada no servidor.</p>

<p>A documentação de cada função da API determina o método e o caminho a ser utilizado, e o significado do corpo e de cada status da resposta.</p>

<p><strong>Atenção:</strong> Toda a comunição cliente/servidor é feita através de HTTP sobre SSL/TLS (HTTPS). Requisições em HTTP simples resultam em redirecionamentos (301) para o protocolo HTTPS.</p>

<p>Todas as requisições da <em>REST API</em> são feitas para <code>api.clicksign.com</code>.</p>

<h2>
<a name="exemplo-de-requisi%C3%A7%C3%A3o" class="anchor" href="#exemplo-de-requisi%C3%A7%C3%A3o"><span class="octicon octicon-link"></span></a>Exemplo de requisição</h2>

<div class="highlight highlight-http"><pre><span class="err">GET /documents HTTPS/1.1</span>
<span class="err">Host: api.clicksign.com</span>
<span class="err">Accept: application/json</span>
</pre></div>

<ul>
<li>Método: GET</li>
<li>Caminho: /documents</li>
<li>Versão: 1.1</li>
<li>Cabeçalhos: Host, Accept</li>
<li>Corpo: vazio</li>
</ul><h2>
<a name="exemplo-de-resposta" class="anchor" href="#exemplo-de-resposta"><span class="octicon octicon-link"></span></a>Exemplo de resposta</h2>

<div class="highlight highlight-http"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span><span class="l">application/json</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">Keep-Alive</span>
</pre></div>

<div class="highlight highlight-json"><pre><span class="p">[</span>
  <span class="p">{</span>
    <span class="nt">"id"</span><span class="p">:</span> <span class="s2">"abcd..."</span>
  <span class="p">},</span>

  <span class="p">{</span>
    <span class="nt">"id"</span><span class="p">:</span> <span class="s2">"..."</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>

<ul>
<li>Versão: 1.1</li>
<li>Status: 200</li>
<li>Mensagem: OK</li>
<li>Cabeçalhos: Content-Type, Connection</li>
<li>Corpo: [{...</li>
</ul><h1>
<a name="autentica%C3%A7%C3%A3o" class="anchor" href="#autentica%C3%A7%C3%A3o"><span class="octicon octicon-link"></span></a>
<a name="autenticacao"></a>Autenticação</h1>

<p>A Clicksign utiliza duplo fator de autenticação para aumentar a segurança de suas transações. Autenticações que utilizam duplo fator geralmente são baseadas em algo que o cliente <em>conhece</em> e algo que o cliente <em>possui</em>. No caso da API os fatores são:</p>

<ol>
<li>Conhecer uma <em>string</em> de <strong>identificação</strong>
</li>
<li>Possuir um endereço <strong>IP</strong> específico</li>
</ol><p>A autenticação é feito através do parâmetro <strong>access_token</strong> que automaticamente determina um usuário e realiza sua autenticação. O parâmetro deve ser enviado no <strong>caminho</strong> da requisição. Portanto, toda requisição deverá conter no <em>path</em> <code>?access_token=string-do-token</code>.</p>

<p><strong>Atenção:</strong> O parâmetro de autenticação deve ser enviado a cada requisição feita pelo cliente. Como esse parâmetro é comum a todas as funções da API, ele será omitido das documentações.</p>

<p>O segundo fator da autenticação é realizado automaticamente pelo servidor da Clicksign, que verifica se o <strong>IP</strong> de origem da requisição está dentro de uma lista de endereços previamente cadastrados para determinado cliente. Este fator de autenticação é <strong>opcional</strong>.</p>

<h1>
<a name="vers%C3%A3o" class="anchor" href="#vers%C3%A3o"><span class="octicon octicon-link"></span></a>
<a name="versao"></a>Versão</h1>

<p>Para possibilitar a expansão contínua da API, a Clicksign implementa um sistema de versões. Dessa forma é necessário que a requisição contenha qual versão da API está sendo utilizada. Isto é feito através do cabeçalho <code>Accept</code> que deverá possuir o valor <code>application/vnd.clicksign.v1</code>. Caso haja mais de um valor para o cabeçalho <code>Accept</code>, eles deverão ser concatenados utilizando <code>;</code>, p.e.: <code>Accept: application/vnd.clicksign.v1; application/json</code>.</p>

<p>Atualmente a Clicksign possui apenas este cabeçalho para versões, mas a medida que outras versões forem implementadas, outros valores serão possíveis.</p>

<h1>
<a name="upload-de-documentos" class="anchor" href="#upload-de-documentos"><span class="octicon octicon-link"></span></a>
<a name="upload-de-documentos"></a>Upload de documentos</h1>

<p>O processo de envio de um documento para a Clicksign contempla a criação de um arquivo de <strong>log</strong> contendo informações de <em>upload</em>, usuário, etc, anexado a uma cópia do documento "carimbada" com um <strong>número de série</strong>. Ao final do processo haverá 2 arquivos na Clicksign: documento original e arquivo de log. Enquanto o arquivo é processado a requisição <em>não fica bloqueada</em>. O <em>status</em> do documento será <em>working</em> enquanto o processo ocorre. Após concluído, o <em>status</em> será <em>open</em>.</p>

<ul>
<li>
<strong>Method:</strong> POST</li>
<li>
<strong>Path:</strong> /documents

<ul>
<li>
<strong>Content-Type:</strong> multipart/mixed; boundary=frontier</li>
<li>
<strong>Accept</strong>: application/json</li>
</ul>
</li>
<li>
<p><strong>Corpo:</strong></p>

<ul>
<li>
<strong>Content-Type:</strong> application/octet-stream</li>
<li>
<strong>Content-Transfer-Encoding:</strong> base64</li>
</ul>
<pre><code>--frontier--
PGh0bWw+CiAgPGhlYWQ+CiAgPC9oZWFkPgogIDxib2R5PgogICAgPHA+VGhpcyBpcyB0aGUg
Ym9keSBvZiB0aGUgbWVzc2FnZS48L3A+CiAgPC9ib2R5Pgo8L2h0bWw+Cg==
--frontier--
</code></pre>
</li>
</ul><h2>
<a name="exemplo-de-resposta-1" class="anchor" href="#exemplo-de-resposta-1"><span class="octicon octicon-link"></span></a>Exemplo de resposta</h2>

<div class="highlight highlight-http"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span><span class="l">application/json</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">Keep-Alive</span>
</pre></div>

<div class="highlight highlight-json"><pre><span class="p">{</span>
  <span class="nt">"key"</span><span class="p">:</span> <span class="s2">"0123-4567-89ab-cdef"</span><span class="p">,</span>
  <span class="nt">"status"</span><span class="p">:</span> <span class="s2">"working"</span>
<span class="p">}</span>
</pre></div>

<h2>
<a name="resposta-4xx" class="anchor" href="#resposta-4xx"><span class="octicon octicon-link"></span></a>Resposta 4XX</h2>

<p>Caso o cliente utilize parâmetros inválidos, o corpo da resposta será um <em>JSON</em> contendo uma mensagem de erro.</p>

<ul>
<li>
<strong>Cabeçalhos</strong>:

<ul>
<li>
<strong>Content-Type:</strong> application/json</li>
</ul>
</li>
<li><strong>Corpo:</strong></li>
</ul><div class="highlight highlight-json"><pre><span class="p">{</span> <span class="nt">"message"</span><span class="p">:</span> <span class="s2">"Invalid parameters."</span> <span class="p">}</span>
</pre></div>

<h2>
<a name="resposta-5xx" class="anchor" href="#resposta-5xx"><span class="octicon octicon-link"></span></a>Resposta 5XX</h2>

<p>Caso ocorra qualquer tipo de falha no servidor, o corpo da resposta será um <em>JSON</em> contendo uma mensagem de erro.</p>

<ul>
<li>
<strong>Cabeçalhos</strong>:

<ul>
<li>
<strong>Content-Type:</strong> application/json</li>
</ul>
</li>
<li><strong>Corpo:</strong></li>
</ul><div class="highlight highlight-json"><pre><span class="p">{</span> <span class="nt">"message"</span><span class="p">:</span> <span class="s2">"Server error."</span> <span class="p">}</span>
</pre></div>

<h1>
<a name="cria%C3%A7%C3%A3o-de-lista-de-assinatura" class="anchor" href="#cria%C3%A7%C3%A3o-de-lista-de-assinatura"><span class="octicon octicon-link"></span></a>
<a name="criacao-de-lista-de-assinatura"></a>Criação de lista de assinatura</h1>

<p>É possível criar uma lista de assinatura e enviá-la a outras pessoas em uma única ação. Para isso, é necessário que estejam presentes os campos que especificam o documento, os signatários, e a mensagem.</p>

<ul>
<li>
<strong>Method:</strong> POST</li>
<li>
<strong>Path:</strong> /documents/:key/list</li>
<li>
<strong>Cabeçalhos:</strong>

<ul>
<li>
<strong>Content-Type:</strong> application/json</li>
<li>
<strong>Accept</strong>: application/json</li>
</ul>
</li>
<li>
<p><strong>Corpo:</strong></p>

<div class="highlight highlight-json"><pre><span class="p">{</span>
  <span class="nt">"signers"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="nt">"email"</span><span class="p">:</span> <span class="s2">"foo@example.com"</span><span class="p">,</span> <span class="nt">"act"</span><span class="p">:</span> <span class="s2">"sign"</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nt">"email"</span><span class="p">:</span> <span class="s2">"bar@example.com"</span><span class="p">,</span> <span class="nt">"act"</span><span class="p">:</span> <span class="s2">"witness"</span> <span class="p">}</span>
  <span class="p">],</span>

  <span class="nt">"message"</span><span class="p">:</span> <span class="s2">"Hi guys, please sign this document."</span>
<span class="p">}</span>
</pre></div>
</li>
</ul><p>Para criar uma lista de assinatura, adicionar signatários ao documento e iniciar o processo de assinatura automaticamente, deve-se adicionar um campo <code>signers</code> ao JSON. Caso não haja o campo <code>signers</code> ou ele seja <code>null</code>, o documento não possuirá lista de assinatura definida.</p>

<p>O campo <code>signers</code> deverá ser um <code>Array</code> contendo os signatários. Cada signatário é especificado através de e-mail e ação, sendo os respectivos campos <code>email</code> e <code>act</code>.</p>

<p>Os possíveis campos de <code>act</code> são:</p>

<ul>
<li>sign</li>
<li>approve</li>
<li>acknowledge</li>
<li>witness</li>
<li>intervenient</li>
<li>party</li>
<li>receipt</li>
</ul><p>A mensagem a ser enviada aos signatários é definida pelo campo <code>message</code>.</p>

<h1>
<a name="hooks" class="anchor" href="#hooks"><span class="octicon octicon-link"></span></a>
<a name="hooks"></a>Hooks</h1>

<p>É possível que a Clicksign notifique outras aplições à respeito da alteração de estado de um determinado documento. O estado de um documento é alterado quando um dos seguintes eventos ocorrem:</p>

<ul>
<li>o documento é processado</li>
<li>alguém se recusa a assinar o documento</li>
<li>o documento é completamente assinado</li>
</ul><p>Para isso, a Clicksign dispõe de um sistema de <strong>hooks</strong> que realizam chamadas HTTP para outras aplicações. As <em>hooks</em> são definidas por documento, portanto cada documento deve configurar as <em>hooks</em> com os parâmetros que deseja.</p>

<p>Quando o documento alterar o seu estado, a Clicksign irá realizar um POST para a <code>url</code> que foi configurada na <em>hook</em> do documento. No corpo da requisição irá em anexo a chave do documento em formato JSON. Portanto você pode determinar para cada documento um endereço específico a ser notificado ou colocar em todos os documentos o mesmo endereço a ser notificado e o servidor que atender a requisição inspecionar o JSON e determinar o que fazer com cada documento em particular.</p>

<ul>
<li>
<strong>URL</strong>: caminho completo, incluíndo protocolo</li>
<li>
<strong>Content-Type</strong>: application/json</li>
</ul><h2>
<a name="configura%C3%A7%C3%A3o-de-hooks" class="anchor" href="#configura%C3%A7%C3%A3o-de-hooks"><span class="octicon octicon-link"></span></a>Configuração de hooks</h2>

<p>Cadastra um <em>hook</em> para um determinado usuário.</p>

<ul>
<li>
<strong>Method:</strong> POST</li>
<li>
<strong>Path:</strong> /documents/:key/hooks</li>
<li>
<strong>Corpo:</strong>
<code>json
{
  "url": "https://example.com/signed/123",
}
</code>
</li>
</ul><h2>
<a name="resposta-200" class="anchor" href="#resposta-200"><span class="octicon octicon-link"></span></a>Resposta 200</h2>

<p>Caso não ocorra nenhuma falha na requisição, a resposta será status 200 e seu corpo será um JSON contendo os dados da <em>hook</em> recém criada.</p>

<div class="highlight highlight-http"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span><span class="l">application/json</span>
</pre></div>

<div class="highlight highlight-json"><pre><span class="p">{</span>
  <span class="nt">"id"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
  <span class="nt">"url"</span><span class="p">:</span><span class="s2">"http://example.com"</span><span class="p">,</span>
  <span class="nt">"document_id"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nt">"created_at"</span><span class="p">:</span><span class="s2">"2014-07-08T12:35:55.777-03:00"</span><span class="p">,</span>
  <span class="nt">"updated_at"</span><span class="p">:</span><span class="s2">"2014-07-08T12:35:55.777-03:00"</span>
<span class="p">}</span>
</pre></div>

<h2>
<a name="resposta-4xx-1" class="anchor" href="#resposta-4xx-1"><span class="octicon octicon-link"></span></a>Resposta 4XX</h2>

<p>Caso o cliente utilize parâmetros inválidos, o corpo da resposta será um <em>JSON</em> contendo uma mensagem de erro.</p>

<ul>
<li>
<strong>Cabeçalhos</strong>:

<ul>
<li>
<strong>Content-Type:</strong> application/json</li>
</ul>
</li>
<li>
<p><strong>Corpo:</strong></p>

<div class="highlight highlight-json"><pre><span class="p">{</span>
  <span class="nt">"message"</span><span class="p">:</span> <span class="s2">"Parâmetros inválidos."</span>
<span class="p">}</span>
</pre></div>
</li>
</ul><h2>
<a name="resposta-5xx-1" class="anchor" href="#resposta-5xx-1"><span class="octicon octicon-link"></span></a>Resposta 5XX</h2>

<p>Caso ocorra qualquer tipo de falha no servidor, o corpo da resposta será um <em>JSON</em> contendo uma mensagem de erro.</p>

<ul>
<li>
<strong>Cabeçalhos</strong>:

<ul>
<li>
<strong>Content-Type:</strong> application/json</li>
</ul>
</li>
<li>
<p><strong>Corpo:</strong></p>

<div class="highlight highlight-json"><pre><span class="p">{</span>
  <span class="nt">"message"</span><span class="p">:</span> <span class="s2">"Server error."</span>
<span class="p">}</span>
</pre></div>
</li>
</ul><h1>
<a name="exemplos" class="anchor" href="#exemplos"><span class="octicon octicon-link"></span></a>
<a name="exemplos"></a>Exemplos</h1>

<p>Os exemplos abaixo podem ser executados direto da linha de comando utilizando o cURL.</p>

<div class="highlight highlight-bash"><pre><span class="nb">export </span><span class="nv">TOKEN</span><span class="o">=</span>put-your-token-here
<span class="nb">export </span><span class="nv">DOCUMENT</span><span class="o">=</span>/home/joe/document-de-exemplo.pdf

<span class="c"># Obter os documentos de uma determinada conta</span>
curl -X GET -H <span class="s2">"Accept: application/vnd.clicksign.v1"</span> https://api.clicksign.com/documents/?access_token<span class="o">=</span><span class="nv">$TOKEN</span>

<span class="c"># Realizar upload de um documento</span>
curl -X POST -H <span class="s2">"Accept: application/vnd.clicksign.v1"</span> -F <span class="s2">"document[archive][original]=@$DOCUMENT"</span> https://api.clicksign.com/documents?access_token<span class="o">=</span><span class="nv">$TOKEN</span>

<span class="nb">export </span><span class="nv">KET</span><span class="o">=</span>ver-key-retornada no JSON

<span class="c"># Criar uma lista de assinatura</span>
curl -X POST -H <span class="s2">"Accept: application/vnd.clicksign.v1"</span> -H <span class="s2">"Accept: application/json"</span> -H <span class="s2">"Content-type: application/json"</span> -d <span class="s1">'{"signers": [{ "email": "joe@example.com", "act": "sign" }]}'</span> https://api.clicksign.com/documents/<span class="nv">$KEY</span>/list?access_token<span class="o">=</span><span class="nv">$TOKEN</span>
</pre></div>
      </section>
      <footer>
        <p><small>Hosted on <a href="http://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>
